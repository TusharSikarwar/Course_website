<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Student Mitra</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="manifest" href="site.webmanifest">
    <link rel="shortcut icon" type="image/x-icon" href="assets/img/favicon.ico">

    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/owl.carousel.min.css">
    <link rel="stylesheet" href="assets/css/slicknav.css">
    <link rel="stylesheet" href="assets/css/flaticon.css">
    <link rel="stylesheet" href="assets/css/progressbar_barfiller.css">
    <link rel="stylesheet" href="assets/css/gijgo.css">
    <link rel="stylesheet" href="assets/css/animate.min.css">
    <link rel="stylesheet" href="assets/css/animated-headline.css">
    <link rel="stylesheet" href="assets/css/magnific-popup.css">
    <link rel="stylesheet" href="assets/css/fontawesome-all.min.css">
    <link rel="stylesheet" href="assets/css/themify-icons.css">
    <link rel="stylesheet" href="assets/css/slick.css">
    <link rel="stylesheet" href="assets/css/nice-select.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Sharp:opsz,wght,FILL,GRAD@48,400,0,0" />
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Sharp:opsz,wght,FILL,GRAD@48,400,0,0" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <link href="https://fonts.googleapis.com/css2?family=Righteous&display=swap" rel="stylesheet">
    
    <link href="https://fonts.googleapis.com/css2?family=Fondamento:ital@1&display=swap" rel="stylesheet">

    <style>
        #drop_zone {
            border: 1px solid rgb(0, 0, 0);
            width: 200px;
            height: 100px;
        }
    </style>

</head>

<body>

    <main>
        <!--? slider Area Start-->
        <section class="slider-area slider-area2">
            <div class="slider-active">
                <!-- Single Slider -->
                <div class="single-slider slider-height2 ">
                    <a href="/logout"><button type="button" class="btn btn-success p-3 border-0" style="margin-left: 90vw; margin-top: 0.5cm; ">Logout..</button></a>
                    <div class="container">
                        <div class="row">
                            <div class="col-xl-8 col-lg-11 col-md-12">
                                <div class="hero__caption hero__caption2">
                                    <h1 data-animation="bounceIn" data-delay="0.2s" id="username" style="font-family: 'Righteous', cursive;">Hello </h1>
                                    <!-- breadcrumb Start-->
                                    <nav aria-label="breadcrumb">
                                        <ol class="breadcrumb">
                                            <li class="breadcrumb-item"><a href="/" style="font-family: 'Fondamento', cursive;">Home</a></li>
                                            <li class="breadcrumb-item"><a href="/courses" style="font-family: 'Fondamento', cursive;">Services</a></li>
                                        </ol>
                                    </nav>
                                    <!-- breadcrumb End -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- Courses area start -->
        <div class="courses-area section-padding3 fix">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-xl-7 col-lg-8">
                        <div class="section-tittle text-center mb-55">
                            <h2 style="font-family: 'Righteous', cursive;">Present courses</h2>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Courses area End -->
        <!-- top subjects End -->


        <div class="container my-4" style="height: 15cm">
            <div class="row justify-content-center">


                <!-- Example split danger button -->
                <div class="btn-group col-8 justify-content-center">
                    <button type="button" class="btn btn-success" style="font-size: medium; font-family: 'Fondamento', cursive;" id="subActive">------------</button>
                    <button type="button" class="btn btn-success dropdown-toggle dropdown-toggle-split col-3" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="font-size: medium;">
                        <span class="sr-only"></span>
                    </button>
                    <div class="dropdown-menu" id="dropdown-menu">
                        <div class="dropdown-divider " ></div>
                        <a class="dropdown-item " onClick="loadSubject()" style="font-family: 'Righteous', cursive;">Load more</a>
                    </div>
                </div>


                <div class="container-xl my-5">
                    <div class="table-responsive">
                        <div class="table-wrapper" style="height: 10cm; overflow-y: auto;">
                            <div class="table-title">
                                <div class="row">
                                    <div class="col-sm-8 d-flex">
                                        <i><h2 style="font-family: 'Righteous', cursive;">Subject <b>Details</b></h2></i>
                                    </div>
                                </div>
                            </div>
                            <table class="table table-striped table-hover table-bordered">
                                <thead>
                                    <tr>
                                        <th style="font-family: 'Righteous', cursive;">File Name</th>
                                        <th style="font-family: 'Righteous', cursive;">Uploaded by :-</th>
                                        <th style="font-family: 'Righteous', cursive;">Uploaded on :-</th>
                                        <th style="font-family: 'Righteous', cursive;">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="addFile">
                                    
                                </tbody>
                            </table>
                            <div class="clearfix">
                            </div>
                        </div>
                        <button type="button" class="btn m-2 p-3 border-0 btn-primary btn-sm justify-content-center" onclick="loadTableData(null)" style="font-family: 'Righteous', cursive;">Load more data ....</button>
                    </div>
                </div>
                <div class="col-4" id="message"><i>>>> </i><span></span></div>

                </div>
            </div>
        </div>

        <!-- Single -->
        <div id="container " class="container my-5 justify-content-center" id="dragDrop" >
            <div  id="drop_zone" class="  justify-content-start" ondrop="dropHandler(event);"  ondragover="dragOverHandler(event);" style="background-color: rgb(173, 182, 248); border-radius: 5%; border-color: rgb(13, 108, 190);">  
                <p type="input" name="file" class="d-inline m-auto justify-content-center " style="color: rgb(233, 251, 251); font-weight: 800;" ><i style="font-family: 'Fondamento', cursive;"> Drag and drop your file here pdf/doc format</i>. <span class="material-symbols-outlined">upload</span></p>
            </div>
            <button type="button" class="btn m-2 p-3 border-0 btn-primary btn-sm justify-content-center" onclick="sendToServer()" style="font-family: 'Righteous', cursive;">Add File....</button>
        </div>


    </main>




    <footer>
     <div class="footer-wrappper footer-bg">
        <!-- Footer Start-->
        <div class="footer-area footer-padding">
            <div class="container">
                <div class="row justify-content-between">
                    <div class="col-xl-4 col-lg-5 col-md-4 col-sm-6">
                        <div class="single-footer-caption mb-50">
                            <div class="single-footer-caption mb-30">
                                <!-- logo -->
                                <div class="footer-logo mb-25">
                                    <a href="/"><img src="assets/img/gallery/logo.svg" alt="" height="75cm" width="100cm"> </a>
                                </div>
                                <div class="footer-tittle">
                                    <div class="footer-pera">
                                        <p style="font-family: 'Fondamento', cursive;">An expert is a man who knows just that much more about his subject than his associates. Most of us are nearer the top than we think. We fail to realize how easy it is, how necessary it is to learn that fraction more.</p>
                                    </div>
                                </div>
                                <!-- social -->
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-2 col-lg-3 col-md-4 col-sm-5">
                        <div class="single-footer-caption mb-50">
                            <div class="footer-tittle">
                                <form >
                                    <h4 style="font-family: 'Righteous', cursive;">Message to admin</h4>
                                    <div class="form-row text-white">
                                      <div class="form-group col-md-6">
                                        <input type="text" id="myEmail" class="form-control" aria-label="Small" aria-describedby="inputGroup-sizing-sm" placeholder="Your Email">
                                      </div>
                                    </div>
                                    <div class="form-row text-white">
                                      <div class="form-group col-md-6">
                                        <input type="text" id="myName" class="form-control" aria-label="Small" aria-describedby="inputGroup-sizing-sm" placeholder="Your Name">
                                      </div>
                                    </div>
                                    <div class="input-group">
                                      <textarea class="form-control" id="myMessage" aria-label="With textarea" placeholder="Enter your Message"></textarea>
                                    </div>
                                    <button type="button" onclick="sendMessage()" class=" my-2 p-3 border-0 btn-outline-light rounded-circle btn-sm justify-content-center" style="cursor: pointer; font-family: 'Fondamento', cursive;" >Send</button>
                                </form>
                            </div>
                        </div>
                    </div>
                    <script>
                        function sendMessage(){

                                axios.post('/adminMes',{
                                email: document.getElementById('myEmail').value,
                                name: document.getElementById('myName').value,
                                message: document.getElementById('myMessage').value,
                            }).then((response) => {
                                // console.log(response)
                                alert('We got your message ');                                                        
                            }).catch((err) => {
                                alert('Some error came up while sending to admin !')
                                console.log(err)
                            });
                        }
                    </script>
                    <div class="col-xl-2 col-lg-3 col-md-4 col-sm-5">
                        <div class="single-footer-caption mb-50">
                            <div class="footer-tittle">
                                <h4 style="font-family: 'Righteous', cursive;">Assignments</h4>
                                <ul>
                                    <li><a href="/courses?courseName=Data Structure and Algorithm & Computative Coding" style="font-family: 'Fondamento', cursive;">DSA & CC</a></li>
                                    <li><a href="/courses?courseName=Theory of Computation" style="font-family: 'Fondamento', cursive;">TOC</a></li>
                                    <li><a href="/courses" style="font-family: 'Fondamento', cursive;">and many more -></a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- footer-bottom area -->
        <div class="footer-bottom-area">
            <div class="container">
                <div class="footer-border">
                    <div class="row d-flex align-items-center">
                        <div class="col-xl-12 ">
                            <div class="footer-copy-right text-center">
                                <p style="font-family: 'Fondamento', cursive;"><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                                  Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved 
                                  <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --></p>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
          <!-- Footer End-->
      </div>
  </footer> 
    <!-- Scroll Up -->








</body>
<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>  
<script>
            let allFiles ;
    let subjectId=1;
    function loadSubject(){
        subInfo = axios.post('/subLoad', {
            subjectId: subjectId,
        }).then(response =>{
            // console.log(response.data)
            if(response.data.newSubjects != null){
                document.getElementById('dropdown-menu').insertAdjacentHTML('afterbegin', `<a class="dropdown-item" onClick="loadSubjectData('${response.data.newSubjects}') " style="font-family: 'Fondamento', cursive;" >${response.data.newSubjects}</a>`);
                subjectId = response.data.newSubjectId;       
            }else{
                alert('No more subjects !');
                
            }              
        },error => {
            
            alert('Some error came up while loading. Try again')
        })
    }

    function getUrlVars(url) {
        var hash;
        var myJson = {};
        var hashes = url.slice(url.indexOf('?') + 1).split('&');
        for (var i = 0; i < hashes.length; i++) {
            hash = hashes[i].split('=');
            myJson[hash[0]] = hash[1]; 
        }
        return myJson;
    }

    let params = getUrlVars(document.URL);

    if (params.passincorrect == 1) {
        al = params.alert.replaceAll("%20", " ");
        alert(al);
    }

    if(params.username != undefined){
        temp = params.username.replaceAll('%20'," ");
        document.getElementById('username').innerText = `Hello ${temp} !`;
    }

    
    function sendToServer(){
        // console.log(allFiles )
        document.getElementById('message').children[1].innerText = 'Sending files !';
        if(allFiles == undefined){
            document.getElementById('message').children[1].innerText = '';
            alert('Nothing in Drag and drop !')
            return;
        }
        else{
            if(document.getElementById('subActive').innerText == '------------'){
                alert('First select the Subject !');
            }else{

                fileData = new FormData()
                // fileData.append('file',allFiles[0]);
                allFiles.forEach((item,i)=>{  
                    // console.log('item ',item)
                    document.getElementById('message').children[1].innerText = `Sending file ${item.name} .....`;
                    fileData.append('file',item,item.name)
                    fileData.append('subject',document.getElementById('subActive').innerText)
                    axios({
                        method:"post",
                        url:"uploadFile",
                        data:fileData
                    }).then((response)=>{
                        console.log(response);
                        if(response.status == 200){
                            document.getElementById('message').children[1].innerText = `File upladed`;
                        }else{
                            document.getElementById('message').children[1].innerText = `Some Error came up. Please Try again !`;
                        }
                    }).catch((response)=>{
                        document.getElementById('message').children[1].innerText = ``;
                        alert(`Error while sending file ${item.name}. Reload page and Try again !`);
                    })
                    // console.log(Object.fromEntries(fileData))
                    fileData.delete('file')
                    fileData.delete('subject')
                })
                temp = document.getElementById('subActive').innerText;
                loadSubjectData(`${temp}`)
            }

        }
    }

    fileDataCount =1;
    function loadSubjectData(subject){
        fileDataCount =1;
        node = document.getElementById("addFile")
        while(node.firstChild){
            node.removeChild(node.firstChild);
        }

        if(subject != null){
            document.getElementById("subActive").innerText = subject;
            loadTableData(subject)        
        }else{
            subject = document.getElementById("subActive").innerText ;
            if(subject == "------------"){
                alert('Select the subject first !');
            }
            else{
                loadTableData(subject)        
            }
        }
    }

    function loadTableData(subject){
        if(subject == null){
            subject = document.getElementById('subActive').innerText; 
            // console.log(subject);
        }
        axios.post('/fetchData', {
            'subject' : subject, 'fileDataCount':fileDataCount, 
        }).then((response) =>{
            console.log(response.data)
            if(response.data == 'No more files !'){
                alert('No more files !')
            }else{
                // console.log(response.data.fileName)
                // console.log(response.data.fileName.split(".").slice(-1)[0])
                viewing =null
                if(response.data.fileName.split(".").slice(-1)[0] == 'pdf'){
                    viewing = 'visibility';
                }else{ viewing = 'visibility_off' }

                fileDataCount = response.data.nextRow;
                document.getElementById('addFile').insertAdjacentHTML('afterbegin',`<tr id='${response.data.fileId}'>
                                            <td style="font-family: 'Fondamento', cursive;">${response.data.fileName}</td>
                                            <td style="font-family: 'Fondamento', cursive;">${response.data.submitedBy}</td>
                                            <td style="font-family: 'Righteous', cursive;">${response.data.time}</td>
                                            <td>
                                                <a href='/fileDownload?fileName=${response.data.fileName}&fileId=${response.data.fileId}' class="download" title="download" data-toggle="tooltip"><i class="material-icons"><span class="material-symbols-outlined">download</span></i></a>
                                                <a href="#message" onClick="deleteFile('${response.data.fileId}')"" class="delete" title="Delete" data-toggle="tooltip"><i class="material-icons"><span class="material-symbols-sharp">delete</span></i></a>
                                            </td>
                                        </tr>`)
            }
                       
        },(error) => {
            
            alert('Some error came up while loading data in table. Try again')
        })
    }

    function deleteFile(fileId){
        console.log('in delete')
        
        axios.get(`/fileDelete?id=${fileId}`)
        .then(function (response) {
          document.getElementById('message').innerText = 'File Deleted..'
          fileDataCount = fileDataCount-1;
          document.getElementById(`${fileId}`).remove();
        })
        .catch(function (error) {
            document.getElementById('message').innerText = 'Some error came up while deleting File..'
          // handle error
          console.log(error);
          alert("Some error came up. Try again !")
        //   console.log(error);
        })
    }
    

</script>

<script>
    function dropHandler(ev) {
        console.log("File(s) dropped");
        document.getElementById('message').children[1].innerText = 'File in Drop';
        // Prevent default behavior (Prevent file from being opened)
        ev.preventDefault();
        // console.log(ev);
        allFiles=[];
        [...ev.dataTransfer.items].forEach((item, i) => {
                // If dropped items aren't files, reject them
                if (item.kind === "file") {
                    file = item.getAsFile();
                    // console.log(file)
                    allFiles[i] = file;
                    document.getElementById('drop_zone').children[0].children[0].innerText = ` ${i+1} file in drag`;
                    // console.log(`… file[${i}].name = ${file.name}`);
                }
        });
    }

    function dragOverHandler(ev) {
        // Prevent default behavior (Prevent file from being opened)
        ev.preventDefault();
    }

    loadSubject();
    setTimeout(()=>{
        loadSubject();
    },1000)

</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>
<script src="./assets/js/vendor/modernizr-3.5.0.min.js"></script>
<script src="./assets/js/vendor/jquery-1.12.4.min.js"></script>
<script src="./assets/js/popper.min.js"></script>
<script src="./assets/js/bootstrap.min.js"></script>
<script src="./assets/js/jquery.slicknav.min.js"></script>

<script src="./assets/js/jquery.vide.js"></script>

<script src="./assets/js/owl.carousel.min.js"></script>
<script src="./assets/js/slick.min.js"></script>
<!-- One Page, Animated-HeadLin -->
<script src="./assets/js/wow.min.js"></script>
<script src="./assets/js/animated.headline.js"></script>
<script src="./assets/js/jquery.magnific-popup.js"></script>

<!-- Date Picker -->
<script src="./assets/js/gijgo.min.js"></script>
<!-- Nice-select, sticky -->
<script src="./assets/js/jquery.nice-select.min.js"></script>
<script src="./assets/js/jquery.sticky.js"></script>
<!-- Progress -->
<script src="./assets/js/jquery.barfiller.js"></script>

<!-- counter , waypoint,Hover Direction -->
<script src="./assets/js/jquery.counterup.min.js"></script>
<script src="./assets/js/waypoints.min.js"></script>
<script src="./assets/js/jquery.countdown.min.js"></script>
<script src="./assets/js/hover-direction-snake.min.js"></script>

<!-- contact js -->
<script src="./assets/js/contact.js"></script>
<script src="./assets/js/jquery.form.js"></script>
<script src="./assets/js/jquery.validate.min.js"></script>
<script src="./assets/js/mail-script.js"></script>
<script src="./assets/js/jquery.ajaxchimp.min.js"></script>

<!-- Jquery Plugins, main Jquery -->
<script src="./assets/js/plugins.js"></script>
<script src="./assets/js/main.js"></script>
